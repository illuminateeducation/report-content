define('chart3',[], function ($, chart3) {

  return function (instanceData) {

    function onlyUnique(value, index, self) { 
      return self.indexOf(value) === index;
    }

    var sites = [];
    var myData = [];

    for (var i = 0; i < instanceData.series[0].length; i++){
      if (instanceData.series[0][i].site2 != null){
        sites.push(instanceData.series[0][i].site2);
        sites = sites.filter(onlyUnique);
      }
    }

    console.log(`My Sites: ${sites}`);

    //Create an object for each site    
      sites.forEach((el, i)=>{
        myData.push(
          {
            site: el,
            countAtAboveExpectedGrowth: 0,
            countBelowExpectedGrowth: 0
          }
        );
      });

    for (var i = 0; i < instanceData.series[0].length; i++){

      myData.forEach((el, index)=>{
        if (el.site === instanceData.series[0][i].site2) {
          
          if (instanceData.series[0][i].growthStatus === 'Greater Than or Equal to Expected Growth'){
            el.countAtAboveExpectedGrowth += 1;
          }

          if (instanceData.series[0][i].growthStatus === 'Less Than Expected Growth'){
            el.countBelowExpectedGrowth += 1;
          }
        }
      });
    }

    myData.forEach((el) => {
      console.log('myData:');
      console.log(el);
    });

    mySeries1Data = [];
    mySeries2Data = [];

    myData.forEach((el) => {
        mySeries1Data.push([
          el.site,
          el.countAtAboveExpectedGrowth
        ]);
        mySeries2Data.push([
          el.site,
          el.countBelowExpectedGrowth
        ]);
      }
    );

    console.log('mySeriesData:');
    console.log(mySeries1Data);




// Create the chart

  var config = {
    

      chart: {
            renderTo: instanceData.id, 
            backgroundColor: null,
            borderWidth: 0,
            shadow: {
              color: '#C9C9C9',
              offsetX: 0,
              offsetY: 0,
              width: 2
            },
            type: 'column',
            width: instanceData.width,
            height: instanceData.height,
            spacing: [50,30,30,10]
      },
      credits: {
        enabled: false
      },
      title: {
        text: ''
      },
      plotOptions: {
        column: {
          stacking: 'percent',
          dataLabels: {
            enabled: true,
            format: '{point.percentage:.1f}%'
          }

        }
      },
      series: [
        //Series1
          {
            type: "column",
            data: mySeries1Data,
            color: '#72B6ED',
            name: "Greater Than or Equal to Expected Growth"
          },
          {
            type: "column",
            data: mySeries2Data,
            color: '#C13D3D',
            name: "Less Than Expected Growth"
          }
      ], // Closes Series Array
      tooltip: {
        pointFormat: '<span style="color:{point.color}">\u25CF</span> {series.name}: <br><b>{point.y} Students</b><br/><b>{point.percentage:.1f} %</b><br>'
      },
      xAxis: {
        type: "category",
      },
      yAxis: {
        title: {
          text: "% of Students"
        }
      }
      

  } // Closes Config Object

//Render Chart
new Highcharts.Chart(config);
        
  }; //closes return function
        
});  //closes top function

;
